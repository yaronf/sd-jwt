-- Hoogle documentation, generated by Haddock
-- See Hoogle, http://www.haskell.org/hoogle/


-- | Selective Disclosure for JSON Web Tokens (RFC 9901)
--   
--   Implementation of RFC 9901: Selective Disclosure for JSON Web Tokens
--   (SD-JWT)
@package sd-jwt
@version 0.1.0.0


-- | Core data types for SD-JWT (Selective Disclosure for JSON Web Tokens).
--   
--   This module defines all the data types used throughout the SD-JWT
--   library, including hash algorithms, disclosures, SD-JWT structures,
--   and error types. These types correspond to the structures defined in
--   RFC 9901.
module SDJWT.Internal.Types

-- | Hash algorithm identifier for computing disclosure digests.
--   
--   All three algorithms (SHA-256, SHA-384, SHA-512) must be supported.
--   SHA-256 is the default when _sd_alg is not specified in the SD-JWT.
data HashAlgorithm

-- | SHA-256 (default, required)
SHA256 :: HashAlgorithm

-- | SHA-384
SHA384 :: HashAlgorithm

-- | SHA-512
SHA512 :: HashAlgorithm

-- | Salt value (cryptographically secure random).
--   
--   Salts are used when creating disclosures to prevent brute-force
--   attacks. RFC 9901 recommends 128 bits (16 bytes) of entropy.
newtype Salt
Salt :: ByteString -> Salt
[unSalt] :: Salt -> ByteString

-- | Digest (base64url-encoded hash).
--   
--   A digest is the base64url-encoded hash of a disclosure. Digests
--   replace claim values in the SD-JWT payload to enable selective
--   disclosure.
newtype Digest
Digest :: Text -> Digest
[unDigest] :: Digest -> Text

-- | Disclosure for object properties: [salt, claim_name, claim_value]
data ObjectDisclosure
ObjectDisclosure :: Salt -> Text -> Value -> ObjectDisclosure
[disclosureSalt] :: ObjectDisclosure -> Salt
[disclosureName] :: ObjectDisclosure -> Text
[disclosureValue] :: ObjectDisclosure -> Value

-- | Disclosure for array elements: [salt, claim_value]
data ArrayDisclosure
ArrayDisclosure :: Salt -> Value -> ArrayDisclosure
[arraySalt] :: ArrayDisclosure -> Salt
[arrayValue] :: ArrayDisclosure -> Value

-- | Unified disclosure type
data Disclosure
DisclosureObject :: ObjectDisclosure -> Disclosure
DisclosureArray :: ArrayDisclosure -> Disclosure

-- | Encoded disclosure (base64url string)
newtype EncodedDisclosure
EncodedDisclosure :: Text -> EncodedDisclosure
[unEncodedDisclosure] :: EncodedDisclosure -> Text

-- | SD-JWT payload structure Note: This is a simplified representation.
--   The actual payload is a JSON object with _sd arrays and ... objects
--   for arrays.
data SDJWTPayload
SDJWTPayload :: Maybe HashAlgorithm -> Value -> SDJWTPayload

-- | _sd_alg claim
[sdAlg] :: SDJWTPayload -> Maybe HashAlgorithm

-- | The actual JSON payload
[payloadValue] :: SDJWTPayload -> Value

-- | Key Binding information from cnf claim
--   
--   The public key is stored as a JWK JSON string (Text), which is
--   compatible with <a>JWKLike</a>. This allows users to work with JWKs
--   without requiring a direct dependency on the jose library.
newtype KeyBindingInfo
KeyBindingInfo :: Text -> KeyBindingInfo

-- | Holder's public key from cnf claim (JWK JSON string)
[kbPublicKey] :: KeyBindingInfo -> Text

-- | Complete SD-JWT structure (as issued)
data SDJWT
SDJWT :: Text -> [EncodedDisclosure] -> SDJWT

-- | The signed JWT (compact serialization)
[issuerSignedJWT] :: SDJWT -> Text

-- | All disclosures
[disclosures] :: SDJWT -> [EncodedDisclosure]

-- | SD-JWT presentation (with selected disclosures)
data SDJWTPresentation
SDJWTPresentation :: Text -> [EncodedDisclosure] -> Maybe Text -> SDJWTPresentation
[presentationJWT] :: SDJWTPresentation -> Text
[selectedDisclosures] :: SDJWTPresentation -> [EncodedDisclosure]

-- | KB-JWT if present
[keyBindingJWT] :: SDJWTPresentation -> Maybe Text

-- | Processed SD-JWT payload (after verification)
newtype ProcessedSDJWTPayload
ProcessedSDJWTPayload :: Map Text Value -> ProcessedSDJWTPayload
[processedClaims] :: ProcessedSDJWTPayload -> Map Text Value

-- | SD-JWT errors
data SDJWTError
InvalidDisclosureFormat :: Text -> SDJWTError
InvalidDigest :: Text -> SDJWTError
MissingDisclosure :: Text -> SDJWTError
DuplicateDisclosure :: Text -> SDJWTError
InvalidSignature :: Text -> SDJWTError
InvalidKeyBinding :: Text -> SDJWTError
InvalidHashAlgorithm :: Text -> SDJWTError
InvalidClaimName :: Text -> SDJWTError
SaltGenerationError :: Text -> SDJWTError
JSONParseError :: Text -> SDJWTError
SerializationError :: Text -> SDJWTError
VerificationError :: Text -> SDJWTError
instance GHC.Generics.Generic SDJWT.Internal.Types.HashAlgorithm
instance GHC.Read.Read SDJWT.Internal.Types.HashAlgorithm
instance GHC.Show.Show SDJWT.Internal.Types.HashAlgorithm
instance GHC.Classes.Eq SDJWT.Internal.Types.HashAlgorithm
instance GHC.Generics.Generic SDJWT.Internal.Types.Salt
instance GHC.Show.Show SDJWT.Internal.Types.Salt
instance GHC.Classes.Eq SDJWT.Internal.Types.Salt
instance GHC.Generics.Generic SDJWT.Internal.Types.Digest
instance GHC.Show.Show SDJWT.Internal.Types.Digest
instance GHC.Classes.Eq SDJWT.Internal.Types.Digest
instance GHC.Generics.Generic SDJWT.Internal.Types.ObjectDisclosure
instance GHC.Show.Show SDJWT.Internal.Types.ObjectDisclosure
instance GHC.Classes.Eq SDJWT.Internal.Types.ObjectDisclosure
instance GHC.Generics.Generic SDJWT.Internal.Types.ArrayDisclosure
instance GHC.Show.Show SDJWT.Internal.Types.ArrayDisclosure
instance GHC.Classes.Eq SDJWT.Internal.Types.ArrayDisclosure
instance GHC.Generics.Generic SDJWT.Internal.Types.Disclosure
instance GHC.Show.Show SDJWT.Internal.Types.Disclosure
instance GHC.Classes.Eq SDJWT.Internal.Types.Disclosure
instance GHC.Generics.Generic SDJWT.Internal.Types.EncodedDisclosure
instance GHC.Show.Show SDJWT.Internal.Types.EncodedDisclosure
instance GHC.Classes.Eq SDJWT.Internal.Types.EncodedDisclosure
instance GHC.Generics.Generic SDJWT.Internal.Types.KeyBindingInfo
instance GHC.Show.Show SDJWT.Internal.Types.KeyBindingInfo
instance GHC.Classes.Eq SDJWT.Internal.Types.KeyBindingInfo
instance GHC.Generics.Generic SDJWT.Internal.Types.SDJWTPayload
instance GHC.Show.Show SDJWT.Internal.Types.SDJWTPayload
instance GHC.Classes.Eq SDJWT.Internal.Types.SDJWTPayload
instance GHC.Generics.Generic SDJWT.Internal.Types.SDJWT
instance GHC.Show.Show SDJWT.Internal.Types.SDJWT
instance GHC.Classes.Eq SDJWT.Internal.Types.SDJWT
instance GHC.Generics.Generic SDJWT.Internal.Types.SDJWTPresentation
instance GHC.Show.Show SDJWT.Internal.Types.SDJWTPresentation
instance GHC.Classes.Eq SDJWT.Internal.Types.SDJWTPresentation
instance GHC.Generics.Generic SDJWT.Internal.Types.ProcessedSDJWTPayload
instance GHC.Show.Show SDJWT.Internal.Types.ProcessedSDJWTPayload
instance GHC.Classes.Eq SDJWT.Internal.Types.ProcessedSDJWTPayload
instance GHC.Show.Show SDJWT.Internal.Types.SDJWTError
instance GHC.Classes.Eq SDJWT.Internal.Types.SDJWTError


-- | Serialization and deserialization of SD-JWT structures.
--   
--   This module provides functions to serialize and deserialize SD-JWTs
--   to/from the tilde-separated format specified in RFC 9901.
module SDJWT.Internal.Serialization

-- | Serialize SD-JWT to tilde-separated format.
--   
--   Format: <tt><a>JWT</a>~<a>1</a>~<a>2</a>~...~<a>N</a>~</tt>
--   
--   The last tilde is always present, even if there are no disclosures.
serializeSDJWT :: SDJWT -> Text

-- | Deserialize SD-JWT from tilde-separated format.
--   
--   Parses a tilde-separated string into an <a>SDJWT</a> structure.
--   Returns an error if the format is invalid or if a Key Binding JWT is
--   present (use <a>deserializePresentation</a> for SD-JWT+KB).
deserializeSDJWT :: Text -> Either SDJWTError SDJWT

-- | Serialize SD-JWT presentation.
--   
--   Format: <tt><a>JWT</a>~<a>1</a>~...~<a>N</a>~[<a>KB-JWT</a>]</tt>
--   
--   If a Key Binding JWT is present, it is included as the last component.
--   Otherwise, the last component is empty (just a trailing tilde).
serializePresentation :: SDJWTPresentation -> Text

-- | Deserialize SD-JWT presentation.
--   
--   Parses a tilde-separated string into an <a>SDJWTPresentation</a>
--   structure. This handles both SD-JWT (without KB-JWT) and SD-JWT+KB
--   (with KB-JWT) formats.
deserializePresentation :: Text -> Either SDJWTError SDJWTPresentation

-- | Parse tilde-separated format.
--   
--   Low-level function that parses the tilde-separated format and returns
--   the components: (JWT, [Disclosures], Maybe KB-JWT).
--   
--   The last component is <a>Nothing</a> for SD-JWT format (empty string
--   after last tilde) or <a>Just</a> KB-JWT for SD-JWT+KB format.
parseTildeSeparated :: Text -> Either SDJWTError (Text, [EncodedDisclosure], Maybe Text)


-- | Utility functions for SD-JWT operations (low-level).
--   
--   This module provides base64url encoding/decoding, salt generation, and
--   text/ByteString conversions used throughout the SD-JWT library.
--   
--   <h2>Usage</h2>
--   
--   This module contains low-level utilities that are typically used
--   internally by other SD-JWT modules. Most users should use the
--   higher-level APIs in:
--   
--   <ul>
--   <li><a>Issuer</a> - For issuers</li>
--   <li><a>Holder</a> - For holders</li>
--   <li><a>Verifier</a> - For verifiers</li>
--   </ul>
--   
--   These utilities may be useful for: * Advanced use cases requiring
--   custom implementations * Library developers building on top of SD-JWT
--   * Testing and debugging
module SDJWT.Internal.Utils

-- | Base64url encode a ByteString (without padding).
--   
--   This function encodes a ByteString using base64url encoding as
--   specified in RFC 4648 Section 5. The result is URL-safe and does not
--   include padding.
--   
--   <pre>
--   &gt;&gt;&gt; base64urlEncode "Hello, World!"
--   "SGVsbG8sIFdvcmxkIQ"
--   </pre>
base64urlEncode :: ByteString -> Text

-- | Base64url decode a Text (handles padding).
--   
--   This function decodes a base64url-encoded Text back to a ByteString.
--   It handles both padded and unpadded input.
--   
--   Returns <a>Left</a> with an error message if decoding fails.
base64urlDecode :: Text -> Either Text ByteString

-- | Generate a cryptographically secure random salt.
--   
--   Generates 128 bits (16 bytes) of random data as recommended by RFC
--   9901. This salt is used when creating disclosures to ensure that
--   digests cannot be guessed or brute-forced.
--   
--   The salt is generated using cryptonite's secure random number
--   generator.
generateSalt :: MonadIO m => m ByteString

-- | Convert Text to ByteString (UTF-8 encoding).
--   
--   This is a convenience function that encodes Text as UTF-8 ByteString.
textToByteString :: Text -> ByteString

-- | Convert ByteString to Text (UTF-8 decoding).
--   
--   This is a convenience function that decodes a UTF-8 ByteString to
--   Text. Note: This will throw an exception if the ByteString is not
--   valid UTF-8. For safe decoding, use <a>decodeUtf8'</a> instead.
byteStringToText :: ByteString -> Text

-- | Hash bytes using the specified hash algorithm.
--   
--   This function computes a cryptographic hash of the input ByteString
--   using the specified hash algorithm (SHA-256, SHA-384, or SHA-512).
--   Returns the hash digest as a ByteString.
hashToBytes :: HashAlgorithm -> ByteString -> ByteString

-- | Split JSON Pointer path by "/", respecting escapes (RFC 6901).
--   
--   This function properly handles JSON Pointer escaping:
--   
--   <ul>
--   <li>"~1" represents a literal forward slash "/"</li>
--   <li>"~0" represents a literal tilde "~"</li>
--   </ul>
--   
--   Examples: - "a/b" → ["a", "b"] - "a~1b" → ["a/b"] (escaped slash) -
--   "a~0b" → ["a~b"] (escaped tilde) - "a~1<i>b" → ["a</i>", "b"] (escaped
--   slash becomes "<i>", then "</i>" is separator)
--   
--   Note: This function is designed for relative JSON Pointer paths
--   (without leading "/"). Leading slashes are stripped, trailing slashes
--   don't create empty segments, and consecutive slashes are collapsed.
splitJSONPointer :: Text -> [Text]

-- | Unescape JSON Pointer segment (RFC 6901).
--   
--   Converts escape sequences back to literal characters:
--   
--   <ul>
--   <li>"~1" → "/"</li>
--   <li>"~0" → "~"</li>
--   </ul>
--   
--   Note: Order matters - must replace ~1 before ~0 to avoid
--   double-replacement.
unescapeJSONPointer :: Text -> Text

-- | Constant-time equality comparison for ByteStrings.
--   
--   This function performs a constant-time comparison to prevent timing
--   attacks. It compares two ByteStrings byte-by-byte and always takes the
--   same amount of time regardless of where the first difference occurs.
--   
--   SECURITY: Use this function when comparing cryptographic values like
--   digests, hashes, or other sensitive data that could be exploited via
--   timing attacks.
--   
--   Implementation uses cryptonite's <a>constEq</a> which provides
--   constant-time comparison for ByteArray instances. ByteString is a
--   ByteArray instance.
constantTimeEq :: ByteString -> ByteString -> Bool


-- | JWT signing and verification using jose library.
--   
--   This module provides functions for signing and verifying JWTs using
--   the jose library. It supports both Text-based JWK strings and jose JWK
--   objects.
module SDJWT.Internal.JWT

-- | Sign a JWT payload using a private key.
--   
--   Parameters: - privateKeyJWK: Private key as JSON Web Key (JWK) - can
--   be Text (JSON string) or jose JWK object - payload: The JWT payload as
--   Aeson Value
--   
--   Returns the signed JWT as a compact string, or an error. Automatically
--   detects key type and uses:
--   
--   <ul>
--   <li>PS256 for RSA keys (default, RS256 also supported via JWK "alg"
--   field)</li>
--   <li>EdDSA for Ed25519 keys</li>
--   <li>ES256 for EC P-256 keys</li>
--   </ul>
signJWT :: JWKLike jwk => jwk -> Value -> IO (Either SDJWTError Text)

-- | Sign a JWT payload with optional typ header parameter.
--   
--   This function allows setting a typ header for issuer-signed JWTs (RFC
--   9901 Section 9.11 recommends explicit typing, e.g., "sd-jwt" or
--   "example+sd-jwt"). Use <a>signJWT</a> for default behavior (no typ
--   header).
--   
--   Parameters: - mbTyp: Optional typ header value (RFC 9901 Section 9.11
--   recommends explicit typing for issuer-signed JWTs) - privateKeyJWK:
--   Private key JWK - can be Text (JSON string) or jose JWK object -
--   payload: The JWT payload as Aeson Value
--   
--   Returns the signed JWT as a compact string, or an error.
signJWTWithOptionalTyp :: JWKLike jwk => Maybe Text -> jwk -> Value -> IO (Either SDJWTError Text)

-- | Sign a JWT payload with a custom typ header parameter.
--   
--   This function constructs the JWT header with the specified typ value,
--   then signs the JWT. This is needed for KB-JWT which requires typ:
--   "kb+jwt" (RFC 9901 Section 4.3).
--   
--   Supports all algorithms: EC P-256 (ES256), RSA (PS256 default, RS256
--   also supported), and Ed25519 (EdDSA).
--   
--   Parameters: - typ: The typ header value (e.g., "kb+jwt" for KB-JWT) -
--   privateKeyJWK: Private key JWK - can be Text (JSON string) or jose JWK
--   object - payload: The JWT payload as Aeson Value
--   
--   Returns the signed JWT as a compact string, or an error.
signJWTWithTyp :: JWKLike jwk => Text -> jwk -> Value -> IO (Either SDJWTError Text)

-- | Verify a JWT signature using a public key.
--   
--   Parameters: - publicKeyJWK: Public key as JSON Web Key (JWK) - can be
--   Text (JSON string) or jose JWK object - jwtText: The JWT to verify as
--   a compact string - requiredTyp: Required typ header value (Nothing =
--   allow any/none, Just "sd-jwt" = require exactly "sd-jwt")
--   
--   Returns the decoded payload if verification succeeds, or an error.
verifyJWT :: JWKLike jwk => jwk -> Text -> Maybe Text -> IO (Either SDJWTError Value)

-- | Parse a JWK from JSON Text.
--   
--   Parses a JSON Web Key (JWK) from its JSON representation. Supports
--   RSA, Ed25519, and EC P-256 keys.
--   
--   The JWK JSON format follows RFC 7517. Examples:
--   
--   <ul>
--   <li>RSA public key: {"kty":<a>RSA</a>,"n":"...","e":"..."}</li>
--   <li>Ed25519 public key:
--   {"kty":<a>OKP</a>,"crv":<a>Ed25519</a>,"x":"..."}</li>
--   <li>EC P-256 public key:
--   {"kty":<a>EC</a>,"crv":"P-256","x":"...","y":"..."}</li>
--   <li>RSA private key:
--   {"kty":<a>RSA</a>,"n":"...","e":"...","d":"...","p":"...","q":"..."}</li>
--   <li>Ed25519 private key:
--   {"kty":<a>OKP</a>,"crv":<a>Ed25519</a>,"d":"...","x":"..."}</li>
--   <li>EC P-256 private key:
--   {"kty":<a>EC</a>,"crv":"P-256","d":"...","x":"...","y":"..."}</li>
--   </ul>
parseJWKFromText :: Text -> Either SDJWTError JWK

-- | Type class for types that can be converted to a jose JWK.
--   
--   This allows functions to accept both Text (JWK JSON strings) and jose
--   JWK objects. Users can pass JWK strings directly without importing
--   jose, or pass jose JWK objects if they're already working with the
--   jose library.
class JWKLike a

-- | Convert to a jose JWK object.
toJWK :: JWKLike a => a -> Either SDJWTError JWK
instance SDJWT.Internal.JWT.JWKLike Data.Text.Internal.Text
instance SDJWT.Internal.JWT.JWKLike Crypto.JOSE.JWK.JWK


-- | Key Binding JWT support for SD-JWT+KB.
--   
--   This module provides functions for creating and verifying Key Binding
--   JWTs (KB-JWT) as specified in RFC 9901 Section 7. Key Binding provides
--   proof of possession of a key by the holder.
module SDJWT.Internal.KeyBinding

-- | Create a Key Binding JWT.
--   
--   Creates a KB-JWT that proves the holder possesses a specific key. The
--   KB-JWT contains:
--   
--   <ul>
--   <li>aud: Audience (verifier identifier)</li>
--   <li>nonce: Nonce provided by verifier</li>
--   <li>iat: Issued at timestamp</li>
--   <li>sd_hash: Hash of the SD-JWT presentation</li>
--   </ul>
--   
--   Parameters: - hashAlg: Hash algorithm for computing sd_hash -
--   holderPrivateKey: Private key for signing - can be Text (JSON string)
--   or jose JWK object - audience: Audience claim - nonce: Nonce from
--   verifier - issuedAt: Issued at timestamp (Unix epoch seconds) -
--   presentation: The SD-JWT presentation to bind
--   
--   Returns the signed KB-JWT as a compact JWT string.
createKeyBindingJWT :: JWKLike jwk => HashAlgorithm -> jwk -> Text -> Text -> Int64 -> SDJWTPresentation -> IO (Either SDJWTError Text)

-- | Compute sd_hash for key binding.
--   
--   The sd_hash is computed as the hash of the serialized SD-JWT
--   presentation (without the KB-JWT part). This hash is included in the
--   KB-JWT to bind it to the specific presentation.
--   
--   The hash is computed over the US-ASCII bytes of the presentation
--   string (per RFC 9901). Since the serialized presentation contains only
--   ASCII characters (base64url-encoded strings and tilde separators),
--   UTF-8 encoding produces identical bytes to US-ASCII.
computeSDHash :: HashAlgorithm -> SDJWTPresentation -> Digest

-- | Verify a Key Binding JWT.
--   
--   Verifies that: 1. The KB-JWT signature is valid (using holder's public
--   key) 2. The sd_hash in the KB-JWT matches the computed hash of the
--   presentation 3. The nonce, audience, and iat claims are present and
--   valid
--   
--   Parameters: - hashAlg: Hash algorithm for verifying sd_hash -
--   holderPublicKey: Public key for verification - can be Text (JSON
--   string) or jose JWK object - kbJWT: The Key Binding JWT to verify -
--   presentation: The SD-JWT presentation
--   
--   Returns 'Right ()' if verification succeeds, <a>Left</a> with error
--   otherwise.
verifyKeyBindingJWT :: JWKLike jwk => HashAlgorithm -> jwk -> Text -> SDJWTPresentation -> IO (Either SDJWTError ())

-- | Add key binding to a presentation.
--   
--   Creates a KB-JWT and adds it to the presentation, converting it to
--   SD-JWT+KB format.
addKeyBindingToPresentation :: JWKLike jwk => HashAlgorithm -> jwk -> Text -> Text -> Int64 -> SDJWTPresentation -> IO (Either SDJWTError SDJWTPresentation)


-- | Disclosure creation, encoding, and decoding (low-level).
--   
--   Disclosures are base64url-encoded JSON arrays that contain the
--   cleartext values of selectively disclosable claims. This module
--   provides functions to create disclosures for object properties and
--   array elements, and to encode/decode them.
--   
--   <h2>Usage</h2>
--   
--   This module contains low-level disclosure utilities that are typically
--   used internally by other SD-JWT modules. Most users should use the
--   higher-level APIs in:
--   
--   <ul>
--   <li><a>Issuer</a> - For issuers (handles disclosure creation
--   internally)</li>
--   <li><a>Holder</a> - For holders (handles disclosure selection
--   internally)</li>
--   <li><a>Verifier</a> - For verifiers (handles disclosure verification
--   internally)</li>
--   </ul>
--   
--   These utilities may be useful for: * Advanced use cases requiring
--   custom disclosure handling * Library developers building on top of
--   SD-JWT * Testing and debugging
module SDJWT.Internal.Disclosure

-- | Create disclosure for object property: [salt, claim_name,
--   claim_value].
--   
--   Creates a disclosure for a selectively disclosable object property.
--   The disclosure is a JSON array containing: 1. The salt
--   (base64url-encoded) 2. The claim name 3. The claim value
--   
--   The result is base64url-encoded as required by RFC 9901.
createObjectDisclosure :: Salt -> Text -> Value -> Either SDJWTError EncodedDisclosure

-- | Create disclosure for array element: [salt, claim_value].
--   
--   Creates a disclosure for a selectively disclosable array element. The
--   disclosure is a JSON array containing: 1. The salt (base64url-encoded)
--   2. The array element value
--   
--   Note: Array element disclosures do not include a claim name. The
--   result is base64url-encoded as required by RFC 9901.
createArrayDisclosure :: Salt -> Value -> Either SDJWTError EncodedDisclosure

-- | Decode disclosure from base64url.
--   
--   Decodes a base64url-encoded disclosure string back into a
--   <a>Disclosure</a> value. The disclosure must be a valid JSON array
--   with either 2 elements (for array disclosures) or 3 elements (for
--   object disclosures).
--   
--   Returns <a>Left</a> with an error if the disclosure format is invalid.
decodeDisclosure :: EncodedDisclosure -> Either SDJWTError Disclosure

-- | Encode disclosure to base64url.
--   
--   Encodes a <a>Disclosure</a> value to its base64url-encoded string
--   representation. This is the inverse of <a>decodeDisclosure</a>.
encodeDisclosure :: Disclosure -> EncodedDisclosure

-- | Extract salt from disclosure.
--   
--   Returns the salt value used in the disclosure. The salt is the same
--   regardless of whether it's an object or array disclosure.
getDisclosureSalt :: Disclosure -> Salt

-- | Extract claim name (for object disclosures).
--   
--   Returns <a>Just</a> the claim name for object disclosures, or
--   <a>Nothing</a> for array element disclosures (which don't have claim
--   names).
getDisclosureClaimName :: Disclosure -> Maybe Text

-- | Extract claim value.
--   
--   Returns the claim value from the disclosure, regardless of whether
--   it's an object or array disclosure.
getDisclosureValue :: Disclosure -> Value


-- | Hash computation and verification for SD-JWT disclosures (low-level).
--   
--   This module provides functions for computing digests of disclosures
--   and verifying that digests match disclosures. All three hash
--   algorithms required by RFC 9901 are supported: SHA-256, SHA-384, and
--   SHA-512.
--   
--   <h2>Usage</h2>
--   
--   This module contains low-level hash and digest utilities that are
--   typically used internally by other SD-JWT modules. Most users should
--   use the higher-level APIs in:
--   
--   <ul>
--   <li><a>Issuer</a> - For issuers (handles digest computation
--   internally)</li>
--   <li><a>Holder</a> - For holders (handles digest computation
--   internally)</li>
--   <li><a>Verifier</a> - For verifiers (handles digest verification
--   internally)</li>
--   </ul>
--   
--   These utilities may be useful for:
--   
--   <ul>
--   <li>Advanced use cases requiring custom digest computation</li>
--   <li>Library developers building on top of SD-JWT</li>
--   <li>Testing and debugging</li>
--   </ul>
module SDJWT.Internal.Digest

-- | Compute digest of a disclosure.
--   
--   The digest is computed over the US-ASCII bytes of the
--   base64url-encoded disclosure string (per RFC 9901). The bytes of the
--   hash output are then base64url encoded to produce the final digest.
--   
--   This follows the convention in JWS (RFC 7515) and JWE (RFC 7516).
--   
--   Note: RFC 9901 requires US-ASCII encoding. Since base64url strings
--   contain only ASCII characters (A-Z, a-z, 0-9, -, _), UTF-8 encoding
--   produces identical bytes to US-ASCII for these strings.
computeDigest :: HashAlgorithm -> EncodedDisclosure -> Digest

-- | Verify that a digest matches a disclosure.
--   
--   Computes the digest of the disclosure using the specified hash
--   algorithm and compares it to the expected digest using constant-time
--   comparison. Returns <a>True</a> if they match.
--   
--   SECURITY: Uses constant-time comparison to prevent timing attacks.
--   This is critical for cryptographic verification operations.
verifyDigest :: HashAlgorithm -> Digest -> EncodedDisclosure -> Bool

-- | Parse hash algorithm from text identifier.
--   
--   Parses hash algorithm names from the _sd_alg claim. Returns
--   <a>Nothing</a> if the algorithm is not recognized.
parseHashAlgorithm :: Text -> Maybe HashAlgorithm

-- | Default hash algorithm (SHA-256 per RFC 9901).
--   
--   When the _sd_alg claim is not present in an SD-JWT, SHA-256 is used as
--   the default hash algorithm.
defaultHashAlgorithm :: HashAlgorithm

-- | Convert hash algorithm to text identifier.
--   
--   Returns the hash algorithm name as specified in RFC 9901: "sha-256",
--   "sha-384", or "sha-512".
hashAlgorithmToText :: HashAlgorithm -> Text

-- | Recursively extract digests from JSON value (_sd arrays and array
--   ellipsis objects).
--   
--   This function extracts all digests from a JSON value by: 1. Looking
--   for _sd arrays in objects and extracting string digests 2. Looking for
--   {"...": "<a>digest</a>"} objects in arrays 3. Recursively processing
--   nested structures
--   
--   Used for extracting digests from SD-JWT payloads and disclosure
--   values.
--   
--   Per RFC 9901 Section 4.2.4.1, _sd arrays MUST contain only strings
--   (digests). Returns an error if non-string values are found in _sd
--   arrays.
extractDigestsFromValue :: Value -> Either SDJWTError [Digest]


-- | SD-JWT issuance: Creating SD-JWTs from claims sets.
--   
--   This module provides functions for creating SD-JWTs on the issuer
--   side. It handles marking claims as selectively disclosable, creating
--   disclosures, computing digests, and building the final signed JWT.
--   
--   <h2>Nested Structures</h2>
--   
--   This module supports nested structures (RFC 9901 Sections 6.2 and 6.3)
--   using JSON Pointer syntax (RFC 6901) for specifying nested claim
--   paths.
--   
--   <h3>JSON Pointer Syntax</h3>
--   
--   Nested paths use forward slash (<tt>/</tt>) as a separator:
--   
--   <pre>
--   ["address/street_address", "address/locality"]
--   </pre>
--   
--   This marks <tt>street_address</tt> and <tt>locality</tt> within the
--   <tt>address</tt> object as selectively disclosable.
--   
--   <h3>Escaping Special Characters</h3>
--   
--   JSON Pointer provides escaping for keys containing special characters:
--   
--   <ul>
--   <li><tt>~1</tt> represents a literal forward slash <tt>/</tt></li>
--   <li><tt>~0</tt> represents a literal tilde <tt>~</tt></li>
--   </ul>
--   
--   Examples:
--   
--   <ul>
--   <li><tt>["contact~1email"]</tt> → marks the literal key
--   <tt>"contact/email"</tt> as selectively disclosable</li>
--   <li><tt>["user~0name"]</tt> → marks the literal key
--   <tt>"user~name"</tt> as selectively disclosable</li>
--   <li><tt>["address/email"]</tt> → marks <tt>email</tt> within
--   <tt>address</tt> object as selectively disclosable</li>
--   </ul>
--   
--   <h3>Nested Structure Patterns</h3>
--   
--   The module supports two patterns for nested structures:
--   
--   <ol>
--   <li><i>Structured SD-JWT</i> (Section 6.2): Parent object stays in
--   payload with <tt>_sd</tt> array containing digests for
--   sub-claims.</li>
--   <li><i>Recursive Disclosures</i> (Section 6.3): Parent is selectively
--   disclosable, and its disclosure contains an <tt>_sd</tt> array with
--   digests for sub-claims.</li>
--   </ol>
--   
--   The pattern is automatically detected based on whether the parent
--   claim is also in the selective claims list.
--   
--   <h3>Examples</h3>
--   
--   Structured SD-JWT (Section 6.2):
--   
--   <pre>
--   buildSDJWTPayload SHA256 ["address/street_address", "address/locality"] claims
--   </pre>
--   
--   This creates a payload where <tt>address</tt> object contains an
--   <tt>_sd</tt> array.
--   
--   Recursive Disclosures (Section 6.3):
--   
--   <pre>
--   buildSDJWTPayload SHA256 ["address", "address/street_address", "address/locality"] claims
--   </pre>
--   
--   This creates a payload where <tt>address</tt> digest is in top-level
--   <tt>_sd</tt>, and the <tt>address</tt> disclosure contains an
--   <tt>_sd</tt> array with sub-claim digests.
--   
--   See <a>partitionNestedPaths</a> for detailed JSON Pointer parsing
--   implementation.
module SDJWT.Internal.Issuance

-- | Create a complete SD-JWT (signed).
--   
--   This function creates an SD-JWT and signs it using the issuer's key.
--   Creates a complete SD-JWT with signed JWT using jose.
createSDJWT :: JWKLike jwk => HashAlgorithm -> jwk -> [Text] -> Map Text Value -> IO (Either SDJWTError SDJWT)

-- | Create an SD-JWT with optional typ header (RFC 9901 Section 9.11).
--   
--   This function is similar to <a>createSDJWT</a> but allows specifying a
--   typ header for the issuer-signed JWT. RFC 9901 Section 9.11 recommends
--   explicit typing to prevent confusion attacks. The typ value should be
--   "sd-jwt" or follow the format "example+sd-jwt" (without the
--   "application/" prefix).
--   
--   Parameters: - mbTyp: Optional typ header value (e.g., Just "sd-jwt" or
--   Just "example+sd-jwt") - hashAlg: Hash algorithm for digests -
--   issuerPrivateKeyJWK: Issuer private key JWK - can be Text (JSON
--   string) or jose JWK object - selectiveClaimNames: Claim names to mark
--   as selectively disclosable - claims: Original claims set
--   
--   Returns the created SD-JWT or an error.
createSDJWTWithTyp :: JWKLike jwk => Maybe Text -> HashAlgorithm -> jwk -> [Text] -> Map Text Value -> IO (Either SDJWTError SDJWT)

-- | Create an SD-JWT from a claims set, marking specified claims as
--   selectively disclosable.
--   
--   This is a high-level function that takes: - A list of claim names to
--   mark as selectively disclosable - A hash algorithm (defaults to
--   SHA-256) - A claims set (Map Text Value) - Returns the complete SD-JWT
--   with all disclosures
--   
--   Note: This function does not sign the JWT. For signing, use
--   <a>createSDJWT</a>.
createSDJWTFromClaims :: HashAlgorithm -> [Text] -> Map Text Value -> IO (Either SDJWTError (SDJWTPayload, [EncodedDisclosure]))

-- | Mark a claim as selectively disclosable.
--   
--   This function: 1. Generates a salt for the claim 2. Creates a
--   disclosure 3. Computes the digest 4. Returns the digest and encoded
--   disclosure | Mark a single claim as selectively disclosable
--   (advanced/low-level).
--   
--   This is a low-level function that processes a single claim. Most users
--   should use <a>buildSDJWTPayload</a> or <a>createSDJWT</a> instead,
--   which handle multiple claims and the full SD-JWT creation process.
--   
--   This function: 1. Generates a salt for the claim 2. Creates an object
--   disclosure 3. Computes the digest 4. Returns the digest and encoded
--   disclosure
--   
--   <h2>Advanced Use</h2>
--   
--   Only use this function if you need fine-grained control over
--   individual claim processing, such as custom disclosure creation logic
--   or testing.
markSelectivelyDisclosable :: HashAlgorithm -> Text -> Value -> IO (Either SDJWTError (Digest, EncodedDisclosure))

-- | Mark an array element as selectively disclosable.
--   
--   This function: 1. Generates a salt for the array element 2. Creates an
--   array disclosure (without claim name) 3. Computes the digest 4.
--   Returns the digest and encoded disclosure
--   
--   The digest should be embedded in the array as {"...": "<a>digest</a>"}
--   at the same position as the original element.
markArrayElementDisclosable :: HashAlgorithm -> Value -> IO (Either SDJWTError (Digest, EncodedDisclosure))

-- | Process an array and mark specific elements as selectively disclosable
--   (advanced/low-level).
--   
--   This is a low-level function for processing arrays. Most users should
--   use <a>buildSDJWTPayload</a> or <a>createSDJWT</a>, which handle
--   arrays automatically.
--   
--   Takes an array and a list of indices to mark as selectively
--   disclosable. Returns the modified array with digests replacing
--   selected elements, along with all disclosures created.
--   
--   <h2>Advanced Use</h2>
--   
--   Only use this function if you need fine-grained control over array
--   processing, such as custom array handling logic or testing.
processArrayForSelectiveDisclosure :: HashAlgorithm -> Vector Value -> [Int] -> IO (Either SDJWTError (Vector Value, [EncodedDisclosure]))

-- | Generate a decoy digest.
--   
--   Decoy digests are random digests that don't correspond to any
--   disclosure. They are used to obscure the actual number of selectively
--   disclosable claims.
--   
--   According to RFC 9901 Section 4.2.5, decoy digests should be created
--   by hashing over a cryptographically secure random number, then
--   base64url encoding.
--   
--   <h2>Advanced Use</h2>
--   
--   Decoy digests are an advanced feature used to hide the number of
--   selectively disclosable claims. Most users don't need to call this
--   function directly, as <a>buildSDJWTPayload</a> handles decoy digest
--   generation automatically when needed.
--   
--   Only use this function if you need fine-grained control over decoy
--   generation, such as custom privacy-preserving logic or testing.
addDecoyDigest :: HashAlgorithm -> IO Digest

-- | Build SD-JWT payload from claims, marking specified claims as
--   selectively disclosable.
--   
--   This function: 1. Separates selectively disclosable claims from
--   regular claims 2. Creates disclosures for selectively disclosable
--   claims 3. Computes digests 4. Builds the JSON payload with _sd array
--   containing digests 5. Returns the payload and all disclosures
--   
--   Supports nested structures (Section 6.2, 6.3):
--   
--   <ul>
--   <li>Use JSON Pointer syntax for nested paths:
--   ["address<i>street_address", "address</i>locality"]</li>
--   <li>For Section 6.2 (structured): parent object stays, sub-claims get
--   _sd array within parent</li>
--   <li>For Section 6.3 (recursive): parent is selectively disclosable,
--   disclosure contains _sd array</li>
--   </ul>
buildSDJWTPayload :: HashAlgorithm -> [Text] -> Map Text Value -> IO (Either SDJWTError (SDJWTPayload, [EncodedDisclosure]))


-- | SD-JWT verification: Verifying SD-JWT presentations.
--   
--   This module provides functions for verifying SD-JWT presentations on
--   the verifier side. It handles signature verification, disclosure
--   validation, and payload processing.
module SDJWT.Internal.Verification

-- | Complete SD-JWT verification.
--   
--   This function performs all verification steps: 1. Parses the
--   presentation 2. Verifies issuer signature (required) 3. Extracts hash
--   algorithm 4. Verifies disclosures match digests 5. Verifies key
--   binding (if present) 6. Processes payload to reconstruct claims
--   
--   Returns the processed payload with all claims (both regular
--   non-selectively-disclosable claims and disclosed
--   selectively-disclosable claims).
--   
--   For testing or debugging purposes where signature verification should
--   be skipped, use <a>verifySDJWTWithoutSignature</a> instead.
verifySDJWT :: JWKLike jwk => jwk -> SDJWTPresentation -> Maybe Text -> IO (Either SDJWTError ProcessedSDJWTPayload)

-- | Verify SD-JWT issuer signature.
--   
--   Verifies the signature on the issuer-signed JWT using the issuer's
--   public key.
--   
--   Parameters: - issuerKey: Issuer public key - can be Text (JSON string)
--   or jose JWK object - presentation: SD-JWT presentation to verify -
--   requiredTyp: If Nothing, allow any typ or none (liberal). If Just
--   typValue, require typ to be exactly that value.
verifySDJWTSignature :: JWKLike jwk => jwk -> SDJWTPresentation -> Maybe Text -> IO (Either SDJWTError ())

-- | SD-JWT verification without signature verification.
--   
--   This function performs verification steps 3-6 of <a>verifySDJWT</a>
--   but skips signature verification. This is useful for testing or
--   debugging, but should NOT be used in production as it does not verify
--   the authenticity of the JWT.
--   
--   WARNING: This function does not verify the issuer signature. Only use
--   this function when signature verification is not required (e.g., in
--   tests or when verifying locally-generated JWTs).
verifySDJWTWithoutSignature :: SDJWTPresentation -> IO (Either SDJWTError ProcessedSDJWTPayload)

-- | Verify key binding in a presentation.
--   
--   Verifies the Key Binding JWT if present in the presentation. This
--   includes verifying the KB-JWT signature and sd_hash.
verifyKeyBinding :: JWKLike jwk => HashAlgorithm -> jwk -> SDJWTPresentation -> IO (Either SDJWTError ())

-- | Verify that all disclosures match digests in the payload.
--   
--   This function: 1. Computes digest for each disclosure 2. Verifies each
--   digest exists in the payload's _sd array 3. Checks for duplicate
--   disclosures
verifyDisclosures :: HashAlgorithm -> SDJWTPresentation -> Either SDJWTError ()

-- | Process SD-JWT payload by replacing digests with disclosure values.
--   
--   This function reconstructs the full claims set by: 1. Starting with
--   regular (non-selectively disclosable) claims 2. Replacing digests in
--   _sd arrays with actual claim values from disclosures
processPayload :: HashAlgorithm -> SDJWTPayload -> [EncodedDisclosure] -> Either SDJWTError ProcessedSDJWTPayload

-- | Extract hash algorithm from presentation.
--   
--   Parses the JWT payload and extracts the _sd_alg claim, defaulting to
--   SHA-256.
extractHashAlgorithm :: SDJWTPresentation -> Either SDJWTError HashAlgorithm

-- | Parse payload from JWT.
--   
--   | Parse JWT payload from a JWT string (advanced/internal use).
--   
--   Extracts and decodes the JWT payload (middle part) from a JWT string.
--   This function properly decodes the base64url-encoded payload and
--   parses it as JSON.
--   
--   This function is exported for advanced use cases and internal library
--   use. Most users should use <a>verifySDJWT</a> or
--   <a>verifySDJWTWithoutSignature</a> instead, which handle payload
--   parsing internally.
--   
--   This function is used internally by: * <a>Presentation</a> - To parse
--   payloads when selecting disclosures * <a>verifyDisclosures</a> - To
--   extract digests from payloads * <a>extractHashAlgorithm</a> - To
--   extract hash algorithm from payloads
--   
--   <h2>Advanced/Internal Use</h2>
--   
--   This function is primarily used internally by other modules (e.g.,
--   <a>Presentation</a>). Most users should use higher-level functions
--   like <a>verifySDJWT</a> instead. Only use this function directly if
--   you need fine-grained control over JWT parsing.
parsePayloadFromJWT :: Text -> Either SDJWTError SDJWTPayload

-- | Extract regular (non-selectively disclosable) claims from payload.
--   
--   JWT payloads must be JSON objects (RFC 7519), so this function only
--   accepts Aeson.Object values. Returns an error if given a non-object
--   value.
extractRegularClaims :: Value -> Either SDJWTError (Map Text Value)


-- | SD-JWT presentation: Creating presentations with selected disclosures.
--   
--   This module provides functions for creating SD-JWT presentations on
--   the holder side. The holder selects which disclosures to include when
--   presenting to a verifier.
module SDJWT.Internal.Presentation

-- | Create a presentation with selected disclosures.
--   
--   This is a simple function that creates an SDJWTPresentation from an
--   SDJWT and a list of selected disclosures. The selected disclosures
--   must be a subset of the disclosures in the original SDJWT.
createPresentation :: SDJWT -> [EncodedDisclosure] -> SDJWTPresentation

-- | Select disclosures from an SD-JWT (more flexible version).
--   
--   This function allows selecting disclosures directly by providing the
--   disclosure objects themselves. Useful when you already know which
--   disclosures to include.
selectDisclosures :: SDJWT -> [EncodedDisclosure] -> Either SDJWTError SDJWTPresentation

-- | Select disclosures from an SD-JWT based on claim names.
--   
--   This function: 1. Decodes all disclosures from the SD-JWT 2. Filters
--   disclosures to include only those matching the provided claim names 3.
--   Handles recursive disclosures (Section 6.3): when selecting nested
--   claims, automatically includes parent disclosures if they are
--   recursively disclosable 4. Validates disclosure dependencies (ensures
--   all required parent disclosures are present) 5. Returns a presentation
--   with the selected disclosures
--   
--   Note: This function validates that the selected disclosures exist in
--   the SD-JWT. Supports JSON Pointer syntax for nested paths (e.g.,
--   "address/street_address").
selectDisclosuresByNames :: SDJWT -> [Text] -> Either SDJWTError SDJWTPresentation

-- | Add key binding to a presentation.
--   
--   Creates a Key Binding JWT and adds it to the presentation, converting
--   it to SD-JWT+KB format. The KB-JWT proves that the holder possesses a
--   specific key.
--   
--   Parameters: - hashAlg: Hash algorithm to use for sd_hash computation -
--   holderPrivateKey: Private key for signing the KB-JWT - can be Text
--   (JSON string) or jose JWK object - audience: Audience claim (verifier
--   identifier) - nonce: Nonce provided by verifier - issuedAt: Issued at
--   timestamp (Unix epoch seconds) - presentation: The SD-JWT presentation
--   to add key binding to
--   
--   Returns the presentation with key binding added, or an error if KB-JWT
--   creation fails.
addKeyBinding :: JWKLike jwk => HashAlgorithm -> jwk -> Text -> Text -> Int64 -> SDJWTPresentation -> IO (Either SDJWTError SDJWTPresentation)


-- | Convenience module for SD-JWT holders.
--   
--   This module re-exports everything needed to receive SD-JWTs and create
--   presentations. It provides a focused API for the holder role,
--   excluding modules that holders don't need (like Issuance and
--   Verification).
--   
--   <h2>Usage</h2>
--   
--   For holders, import this module instead of the main <a>SDJWT</a>
--   module:
--   
--   <pre>
--   import SDJWT.Holder
--   </pre>
--   
--   This gives you access to:
--   
--   <ul>
--   <li><a>Types</a> - Core data types</li>
--   <li><a>Serialization</a> - Deserialize SD-JWTs and serialize
--   presentations</li>
--   <li><a>Presentation</a> - Select disclosures and create
--   presentations</li>
--   <li><a>KeyBinding</a> - Add key binding to presentations
--   (SD-JWT+KB)</li>
--   </ul>
--   
--   <h2>Example</h2>
--   
--   <pre>
--   &gt;&gt;&gt; :set -XOverloadedStrings
--   
--   &gt;&gt;&gt; import SDJWT.Holder
--   
--   &gt;&gt;&gt; import qualified Data.Text as T
--   
--   &gt;&gt;&gt; import Data.Int (Int64)
--   
--   &gt;&gt;&gt; -- Deserialize SD-JWT received from issuer
--   
--   &gt;&gt;&gt; -- let sdjwtText = "eyJhbGciOiJSUzI1NiJ9..."
--   
--   &gt;&gt;&gt; -- case deserializeSDJWT (T.pack sdjwtText) of
--   
--   &gt;&gt;&gt; --   Right sdjwt -&gt; selectDisclosuresByNames sdjwt ["given_name"]
--   
--   &gt;&gt;&gt; --   Left err -&gt; Left err
--   
--   &gt;&gt;&gt; -- Optionally add key binding (SD-JWT+KB) for proof of possession
--   
--   &gt;&gt;&gt; -- holderPrivateKeyJWK &lt;- loadPrivateKeyJWK
--   
--   &gt;&gt;&gt; -- addKeyBindingToPresentation SHA256 holderPrivateKeyJWK "verifier.example.com" "nonce123" (1234567890 :: Int64) presentation
--   </pre>
module SDJWT.Holder


-- | Convenience module for SD-JWT issuers.
--   
--   This module re-exports everything needed to create and issue SD-JWTs.
--   It provides a focused API for the issuer role, excluding modules that
--   issuers don't need (like Presentation and Verification).
--   
--   <h2>Security Warning: EC Signing Timing Attack</h2>
--   
--   ⚠️ When using Elliptic Curve (EC) keys (ES256 algorithm), be aware
--   that the underlying <tt>jose</tt> library's EC signing implementation
--   may be vulnerable to timing attacks. This affects <i>signing only</i>,
--   not verification.
--   
--   For applications where timing attacks are a concern, consider using
--   RSA-PSS (PS256) or Ed25519 (EdDSA) keys instead, which do not have
--   this limitation.
--   
--   Note: RS256 (RSA-PKCS#1 v1.5) is deprecated per
--   draft-ietf-jose-deprecate-none-rsa15 due to padding oracle attack
--   vulnerabilities. PS256 (RSA-PSS) is the recommended RSA algorithm and
--   is used by default for RSA keys.
--   
--   <h2>Usage</h2>
--   
--   For issuers, import this module instead of the main <a>SDJWT</a>
--   module:
--   
--   <pre>
--   import SDJWT.Issuer
--   </pre>
--   
--   This gives you access to:
--   
--   <ul>
--   <li><a>Types</a> - Core data types</li>
--   <li><a>Serialization</a> - Serialize SD-JWTs for transmission</li>
--   <li><a>Issuance</a> - Create SD-JWTs from claims</li>
--   </ul>
--   
--   <h2>Example</h2>
--   
--   <pre>
--   &gt;&gt;&gt; :set -XOverloadedStrings
--   
--   &gt;&gt;&gt; import SDJWT.Issuer
--   
--   &gt;&gt;&gt; import qualified Data.Map.Strict as Map
--   
--   &gt;&gt;&gt; import qualified Data.Aeson as Aeson
--   
--   &gt;&gt;&gt; import qualified Data.Text as T
--   
--   &gt;&gt;&gt; let claims = Map.fromList [("sub", Aeson.String "user_123"), ("given_name", Aeson.String "John"), ("family_name", Aeson.String "Doe")]
--   
--   &gt;&gt;&gt; -- Note: In real usage, you would load your private key here
--   
--   &gt;&gt;&gt; -- issuerPrivateKeyJWK &lt;- loadPrivateKeyJWK
--   
--   &gt;&gt;&gt; -- result &lt;- createSDJWT SHA256 issuerPrivateKeyJWK ["given_name", "family_name"] claims
--   
--   &gt;&gt;&gt; -- case result of Right sdjwt -&gt; serializeSDJWT sdjwt; Left err -&gt; T.pack $ show err
--   </pre>
module SDJWT.Issuer


-- | Convenience module for SD-JWT verifiers.
--   
--   This module re-exports everything needed to verify SD-JWT
--   presentations and extract claims. It provides a focused API for the
--   verifier role, excluding modules that verifiers don't need (like
--   Issuance and Presentation).
--   
--   <h2>Usage</h2>
--   
--   For verifiers, import this module instead of the main <a>SDJWT</a>
--   module:
--   
--   <pre>
--   import SDJWT.Verifier
--   </pre>
--   
--   This gives you access to:
--   
--   <ul>
--   <li><a>Types</a> - Core data types</li>
--   <li><a>Serialization</a> - Deserialize presentations</li>
--   <li><a>Verification</a> - Verify SD-JWTs and extract claims</li>
--   <li><a>KeyBinding</a> - Verify key binding (SD-JWT+KB)</li>
--   </ul>
--   
--   <h2>Example</h2>
--   
--   <pre>
--   &gt;&gt;&gt; :set -XOverloadedStrings
--   
--   &gt;&gt;&gt; import SDJWT.Verifier
--   
--   &gt;&gt;&gt; import qualified Data.Text as T
--   
--   &gt;&gt;&gt; -- Deserialize presentation received from holder
--   
--   &gt;&gt;&gt; -- let presentationText = "eyJhbGciOiJSUzI1NiJ9..."
--   
--   &gt;&gt;&gt; -- case deserializePresentation (T.pack presentationText) of
--   
--   &gt;&gt;&gt; --   Right presentation -&gt; do
--   
--   &gt;&gt;&gt; --     issuerPublicKeyJWK &lt;- loadPublicKeyJWK
--   
--   &gt;&gt;&gt; --     verifySDJWT issuerPublicKeyJWK presentation Nothing
--   
--   &gt;&gt;&gt; --   Left err -&gt; Left err
--   
--   &gt;&gt;&gt; -- Extract claims (includes both regular claims and disclosed claims)
--   
--   &gt;&gt;&gt; -- let claims = processedClaims processedPayload
--   </pre>
module SDJWT.Verifier


-- | This module re-exports the persona-specific modules for convenient
--   access. Most users should import the specific persona module they need
--   instead.
--   
--   <h2>Recommended Usage</h2>
--   
--   Import the persona-specific module for your role:
--   
--   <pre>
--   import SDJWT.Issuer   -- For creating and issuing SD-JWTs
--   import SDJWT.Holder   -- For receiving SD-JWTs and creating presentations
--   import SDJWT.Verifier -- For verifying SD-JWT presentations
--   </pre>
--   
--   <h2>Advanced Usage</h2>
--   
--   For library developers or advanced users who need low-level access,
--   import specific Internal modules as needed:
--   
--   <pre>
--   import SDJWT.Internal.Types
--   import SDJWT.Internal.Serialization
--   import SDJWT.Internal.Issuance
--   -- etc.
--   </pre>
module SDJWT
